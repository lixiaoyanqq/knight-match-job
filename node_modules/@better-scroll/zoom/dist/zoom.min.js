!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(t="undefined"!=typeof globalThis?globalThis:t||self).Zoom=o()}(this,function(){"use strict";var t=[{key:"zoomTo",name:"zoomTo"}].map(function(t){return{key:t.key,sourceKey:"plugins.zoom."+t.name}}),n="undefined"!=typeof window,e=n&&navigator.userAgent.toLowerCase();e&&/wechatdevtools/.test(e),e&&e.indexOf("android"),function(){if("string"!=typeof e)return;var t=/os (\d\d?_\d(_\d)?)/.exec(e);if(!t)return;var o=t[1].split("_").map(function(t){return parseInt(t,10)});13<=o[0]&&o[1]}();function m(){return window.performance&&window.performance.now&&window.performance.timing?window.performance.now()+window.performance.timing.navigationStart:+new Date}function g(t,o,e){return t<o?o:e<t?e:t}var r=n&&document.createElement("div").style,o=function(){if(!n)return!1;for(var t=0,o=[{key:"standard",value:"transform"},{key:"webkit",value:"webkitTransform"},{key:"Moz",value:"MozTransform"},{key:"O",value:"OTransform"},{key:"ms",value:"msTransform"}];t<o.length;t++){var e=o[t];if(void 0!==r[e.value])return e.key}return!1}();function i(t){return!1===o?t:"standard"===o?"transitionEnd"===t?"transitionend":t:o+t.charAt(0).toUpperCase()+t.substr(1)}o&&"standard"!==o&&o.toLowerCase(),i("transform"),i("transition"),n&&i("perspective")in r,i("transitionTimingFunction"),i("transitionDuration"),i("transitionDelay");var s=i("transformOrigin");i("transitionEnd"),i("transitionProperty");var d={style:"cubic-bezier(0.165, 0.84, 0.44, 1)",fn:function(t){return 1- --t*t*t*t}},a=n&&window;function l(){}var v=n?a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||function(t){return window.setTimeout(t,(t.interval||100/60)/2)}:l,y=n?a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.mozCancelAnimationFrame||a.oCancelAnimationFrame||function(t){window.clearTimeout(t)}:l;function c(t){this.scroll=t,this.scale=1,this.prevScale=1,this.init()}return c.prototype.init=function(){this.handleBScroll(),this.handleOptions(),this.handleHooks(),this.tryInitialZoomTo(this.zoomOpt)},c.prototype.zoomTo=function(t,o,e,n){var r=this.resolveOrigin(o,e),i={x:r.originX,y:r.originY,baseScale:this.scale};this._doZoomTo(t,i,n,!0)},c.prototype.handleBScroll=function(){this.scroll.proxy(t),this.scroll.registerType(["beforeZoomStart","zoomStart","zooming","zoomEnd"])},c.prototype.handleOptions=function(){var t=!0===this.scroll.options.zoom?{}:this.scroll.options.zoom;this.zoomOpt=function(t,o){for(var e in o)t[e]=o[e];return t}({start:1,min:1,max:4,initialOrigin:[0,0],minimalZoomDistance:5,bounceTime:800},t)},c.prototype.handleHooks=function(){var n=this,t=this.scroll,o=this.scroll.scroller;this.wrapper=this.scroll.scroller.wrapper,this.scaleElement=this.scroll.scroller.content,this.scaleElement.style[s]="0 0",this.scaleElementInitSize=function(t){if(t instanceof window.SVGElement){var o=t.getBoundingClientRect();return{top:o.top,left:o.left,width:o.width,height:o.height}}return{top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}(this.scaleElement);var e=o.scrollBehaviorX,r=o.scrollBehaviorY;this.hooksFn=[],this.registerHooks(t.hooks,t.hooks.eventTypes.beforeInitialScrollTo,function(){return!0}),this.registerHooks(e.hooks,e.hooks.eventTypes.beforeComputeBoundary,function(){e.contentSize=Math.floor(n.scaleElementInitSize.width*n.scale)}),this.registerHooks(r.hooks,r.hooks.eventTypes.beforeComputeBoundary,function(){r.contentSize=Math.floor(n.scaleElementInitSize.height*n.scale)}),this.registerHooks(o.actions.hooks,o.actions.hooks.eventTypes.start,function(t){var o=t.touches&&t.touches.length||0;n.fingersOperation(o),2===o&&n.zoomStart(t)}),this.registerHooks(o.actions.hooks,o.actions.hooks.eventTypes.beforeMove,function(t){var o=t.touches&&t.touches.length||0;if(n.fingersOperation(o),2===o)return n.zoom(t),!0}),this.registerHooks(o.actions.hooks,o.actions.hooks.eventTypes.beforeEnd,function(t){if(2===n.fingersOperation())return n.zoomEnd(),!0}),this.registerHooks(o.translater.hooks,o.translater.hooks.eventTypes.beforeTranslate,function(t,o){var e=o.scale?o.scale:n.prevScale;n.prevScale=e,t.push("scale("+e+")")}),this.registerHooks(o.hooks,o.hooks.eventTypes.scrollEnd,function(){2===n.fingersOperation()&&n.scroll.trigger(n.scroll.eventTypes.zoomEnd,{scale:n.scale})}),this.registerHooks(this.scroll.hooks,"destroy",this.destroy)},c.prototype.tryInitialZoomTo=function(t){var o=t.start,e=t.initialOrigin;this.zoomTo(o,e[0],e[1],0)},c.prototype.fingersOperation=function(t){if("number"!=typeof t)return this.numberOfFingers;this.numberOfFingers=t},c.prototype._doZoomTo=function(t,o,e,n){var r=this;void 0===e&&(e=this.zoomOpt.bounceTime),void 0===n&&(n=!1);var i,s,a,l,c=this.zoomOpt,h=c.min,u=c.max,f=this.scale,p=g(t,h,u);0!==e?0<e&&(s=m(),a=s+e,(l=function(){var t=m();if(a<=t)return r.scroll.trigger(r.scroll.eventTypes.zooming,{scale:p}),void y(i);var o=d.fn((t-s)/e)*(p-f)+f;r.scroll.trigger(r.scroll.eventTypes.zooming,{scale:o}),i=v(l)})()):r.scroll.trigger(r.scroll.eventTypes.zooming,{scale:p}),this.fingersOperation(2),this._zoomTo(p,f,o,e,n)},c.prototype._zoomTo=function(t,o,e,n,r){void 0===r&&(r=!1);var i=t/e.baseScale;this.setScale(t);var s=this.scroll.scroller,a=s.scrollBehaviorX,l=s.scrollBehaviorY;this.resetBoundaries([a,l]);var c=this.getNewPos(e.x,i,a,!0,r),h=this.getNewPos(e.y,i,l,!0,r);a.currentPos===Math.round(c)&&l.currentPos===Math.round(h)&&t===o||s.scrollTo(c,h,n,d,{start:{scale:o},end:{scale:t}})},c.prototype.resolveOrigin=function(t,o){var e=this.scroll.scroller,n=e.scrollBehaviorX,r=e.scrollBehaviorY,i={left:function(){return 0},top:function(){return 0},right:function(){return n.contentSize},bottom:function(){return r.contentSize},center:function(t){return(0===t?n.contentSize:r.contentSize)/2}};return{originX:"number"==typeof t?t:i[t](0),originY:"number"==typeof o?o:i[o](1)}},c.prototype.zoomStart=function(t){var o=t.touches[0],e=t.touches[1];this.startDistance=this.getFingerDistance(t),this.startScale=this.scale;var n,r,i=(n=this.wrapper,{left:-((r=n.getBoundingClientRect()).left+window.pageXOffset),top:-(r.top+window.pageYOffset)}),s=i.left,a=i.top;this.origin={x:Math.abs(o.pageX+e.pageX)/2+s-this.scroll.x,y:Math.abs(o.pageY+e.pageY)/2+a-this.scroll.y,baseScale:this.startScale},this.scroll.trigger(this.scroll.eventTypes.beforeZoomStart)},c.prototype.zoom=function(t){var o,e,n,r,i,s,a,l=this.getFingerDistance(t);!this.zoomed&&Math.abs(l-this.startDistance)<this.zoomOpt.minimalZoomDistance||(e=(o=this.dampingScale(l/this.startDistance*this.startScale))/this.startScale,this.setScale(o),this.zoomed||(this.zoomed=!0,this.scroll.trigger(this.scroll.eventTypes.zoomStart)),r=(n=this.scroll.scroller).scrollBehaviorX,i=n.scrollBehaviorY,s=this.getNewPos(this.origin.x,e,r,!1,!1),a=this.getNewPos(this.origin.y,e,i,!1,!1),this.scroll.trigger(this.scroll.eventTypes.zooming,{scale:this.scale}),n.translater.translate({x:s,y:a,scale:o}))},c.prototype.zoomEnd=function(){this.zoomed&&(this.shouldRebound()?this._doZoomTo(this.scale,this.origin,this.zoomOpt.bounceTime):this.scroll.trigger(this.scroll.eventTypes.zoomEnd,{scale:this.scale}))},c.prototype.getFingerDistance=function(t){var o,e,n=t.touches[0],r=t.touches[1],i=Math.abs(n.pageX-r.pageX),s=Math.abs(n.pageY-r.pageY);return o=i,e=s,Math.sqrt(o*o+e*e)},c.prototype.shouldRebound=function(){var t=this.zoomOpt,o=t.min,e=t.max,n=this.scale;if(n!==g(n,o,e))return!0;var r=this.scroll.scroller,i=r.scrollBehaviorX,s=r.scrollBehaviorY;this.resetBoundaries([i,s]);var a=i.checkInBoundary().inBoundary,l=i.checkInBoundary().inBoundary;return!(a&&l)},c.prototype.dampingScale=function(t){var o=this.zoomOpt,e=o.min,n=o.max;return t<e?t=.5*e*Math.pow(2,t/e):n<t&&(t=2*n*Math.pow(.5,n/t)),t},c.prototype.setScale=function(t){this.scale=t},c.prototype.resetBoundaries=function(t){t.forEach(function(t){return t.computeBoundary()})},c.prototype.getNewPos=function(t,o,e,n,r){void 0===r&&(r=!1);var i=t-t*o+(r?e.currentPos:e.startPos);return n&&(i=g(i,e.maxScrollPos,e.minScrollPos)),0<i?Math.floor(i):Math.ceil(i)},c.prototype.registerHooks=function(t,o,e){t.on(o,e,this),this.hooksFn.push([t,o,e])},c.prototype.destroy=function(){this.hooksFn.forEach(function(t){var o=t[0],e=t[1],n=t[2];o.off(e,n)}),this.hooksFn.length=0},c.pluginName="zoom",c});
